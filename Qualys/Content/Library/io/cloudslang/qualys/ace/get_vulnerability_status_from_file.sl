########################################################################################################################
#!!
#! @input output_file: Path to the file to save the response.
#!!#
########################################################################################################################
namespace: io.cloudslang.qualys.ace
flow:
  name: get_vulnerability_status_from_file
  inputs:
    - output_file: "C:\\response.xml"
  workflow:
    - download_host_detection:
        do:
          io.cloudslang.qualys.vm.download_host_detection:
            - truncation_limit: '15'
            - id_min: '${id_min}'
            - output_file: '${output_file}'
        navigate:
          - FAILURE: on_failure
          - SUCCESS: qualys_vuln_status_xml_to_ace_json_1
    - qualys_vuln_status_xml_to_ace_json_1:
        do:
          io.cloudslang.qualys.utils.qualys_vuln_status_xml_to_ace_json:
            - xml_input: '${output_file}'
            - unique_qids: "${get('unique_qid_list', '')}"
        publish:
          - unique_qid_list
          - id_min
        navigate:
          - HAS_MORE: download_host_detection
          - SUCCESS: cleanup_file
    - cleanup_file:
        do:
          io.cloudslang.base.filesystem.delete:
            - source: '${output_file}'
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      download_host_detection:
        x: 40
        'y': 80
      qualys_vuln_status_xml_to_ace_json_1:
        x: 280
        'y': 80
      cleanup_file:
        x: 480
        'y': 80
        navigate:
          95e66abc-2f3e-4a8f-f877-b21842c51687:
            targetId: 6a80c06f-726d-bc97-3dce-9c1bbfba1ef8
            port: SUCCESS
    results:
      SUCCESS:
        6a80c06f-726d-bc97-3dce-9c1bbfba1ef8:
          x: 720
          'y': 80
